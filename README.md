# åŸºäº FISCO BCOS çš„å¯è§†åŒ–å†œäº§å“ç”Ÿäº§æº¯æºå¹³å°

åŸºäºåŒºå—é“¾æŠ€æœ¯çš„å†œäº§å“å…¨æµç¨‹æº¯æºç³»ç»Ÿï¼Œå®ç°ä»åŸæ–™ç”Ÿäº§åˆ°æ¶ˆè´¹è€…æ‰‹ä¸­çš„å®Œæ•´è¿½æº¯é“¾æ¡ã€‚

## é¡¹ç›®ä¿¡æ¯

- **é¡¹ç›®åç§°**: åŸºäº FISCO BCOSï¼ˆé£æ¢­é“¾ï¼‰çš„å¯è§†åŒ–å†œäº§å“ç”Ÿäº§æº¯æºå¹³å°
- **æŠ€æœ¯æ ˆ**: Vue 3 + Element Plus + Pinia + Python + FISCO BCOS

## ç³»ç»Ÿè§’è‰²

| è§’è‰² | è¯´æ˜ |
|------|------|
| åŸæ–™å•† (producer) | ç™»è®°åŸæ–™ä¿¡æ¯ã€é‡‡æ”¶å‡ºåº“ã€ç”Ÿæˆæº¯æºç  |
| åŠ å·¥å•† (processor) | æ¥æ”¶åŸæ–™ã€åŠ å·¥å¤„ç†ã€é€æ£€ |
| è´¨æ£€å‘˜ (inspector) | è´¨é‡æ£€æµ‹ã€å‡ºå…·æ£€æµ‹æŠ¥å‘Šã€é€€å›/ç»ˆæ­¢å¤„ç† |
| é”€å”®å•† (seller) | å…¥åº“ç®¡ç†ã€é”€å”®ç™»è®°ã€ç”ŸæˆäºŒç»´ç  |
| æ¶ˆè´¹è€… (consumer) | æ‰«ç æŸ¥è¯¢ã€æŸ¥çœ‹AIç®€æŠ¥ã€æŸ¥çœ‹å®Œæ•´é“¾ä¸Šè®°å½• |

## é¡¹ç›®ç»“æ„

```
komi-project/
â”œâ”€â”€ README.md              # æœ¬æ–‡æ¡£
â”œâ”€â”€ å¼€å‘è®¡åˆ’.md            # å¼€å‘è¿›åº¦è¿½è¸ª
â”œâ”€â”€ frontend/              # Vue 3 å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/         # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ producer/  # åŸæ–™å•†æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ processor/ # åŠ å·¥å•†æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ inspector/ # è´¨æ£€å‘˜æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ seller/    # é”€å”®å•†æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ consumer/  # æ¶ˆè´¹è€…æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ trace/     # æº¯æºè¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ store/         # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ product.js # äº§å“é“¾çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ notification.js # é€šçŸ¥çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ user.js    # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ components/    # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ common/    # å…¬å…±ç»„ä»¶
â”‚   â”‚   â””â”€â”€ router/        # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ backend/               # Python FastAPI åç«¯ â­ å·²å®ŒæˆåŸºç¡€æ¡†æ¶
â”œâ”€â”€ blockchain/            # FISCO BCOS æ™ºèƒ½åˆçº¦
â”œâ”€â”€ ai-service/            # Python AI æœåŠ¡
â”œâ”€â”€ docs/                  # å…¶ä»–æ–‡æ¡£
â””â”€â”€ æ¯•è®¾æ–‡ä»¶/              # æ¯•è®¾ç›¸å…³æ–‡æ¡£
```

---

## æ ¸å¿ƒåŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰

### äº§å“é“¾ç”Ÿå‘½å‘¨æœŸ

```
åŸæ–™å•†ç™»è®°(è‰ç¨¿) â†’ ç¡®è®¤ä¸Šé“¾ â†’ ç”Ÿæˆå”¯ä¸€æº¯æºç  â†’ å¾…åŠ å·¥æ± /æŒ‡å®šå‘é€
                                    â†“
åŠ å·¥å•†æ¥æ”¶ â†’ åŠ å·¥è®°å½•ä¸Šé“¾ â†’ é€æ£€
                                    â†“
è´¨æ£€å‘˜æ£€æµ‹ â†’ æ£€æµ‹æŠ¥å‘Šä¸Šé“¾ â†’ åˆæ ¼/é€€å›/ç»ˆæ­¢
                                    â†“
é”€å”®å•†å…¥åº“ â†’ å…¥åº“è®°å½•ä¸Šé“¾ â†’ é”€å”®ç™»è®° â†’ ç”ŸæˆäºŒç»´ç 
                                    â†“
æ¶ˆè´¹è€…æ‰«ç  â†’ AIç”Ÿæˆç®€æŠ¥ â†’ æŸ¥çœ‹è¯¦æƒ…/é“¾ä¸Šè®°å½•
```

### å…³é”®ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| å”¯ä¸€æº¯æºç  | é¦–æ¬¡ä¸Šé“¾æ—¶ç”Ÿæˆï¼Œæ°¸ä¸æ”¹å˜ |
| ä¿®æ­£è®°å½• | ä¸Šé“¾åä¸å¯ä¿®æ”¹åŸè®°å½•ï¼Œåªèƒ½è¿½åŠ ä¿®æ­£è®°å½•ï¼ˆç‰ˆæœ¬é“¾ï¼‰ |
| åˆ†é…æ–¹å¼ | æ”¯æŒ"å…¬å…±æ± è‡ªé€‰"å’Œ"æŒ‡å®šå‘é€"ä¸¤ç§æ¨¡å¼ |
| é€€å›/ç»ˆæ­¢ | è´¨æ£€ä¸åˆæ ¼å¯é€€å›æŒ‡å®šç¯èŠ‚æˆ–ç»ˆæ­¢é“¾æ¡ï¼Œæ“ä½œä¸Šé“¾ |
| æ¶ˆæ¯é€šçŸ¥ | è·¨è§’è‰²å®æ—¶é€šçŸ¥ï¼ŒåŒ…å«å¾…å¤„ç†å’Œé“¾å˜åŠ¨é€šçŸ¥ |
| AIç®€æŠ¥ | æ¶ˆè´¹è€…æ‰«ç åå±•ç¤ºAIç”Ÿæˆçš„äº§å“ç®€æŠ¥ |

### å‰ç«¯æ¨¡å—å®Œæˆæƒ…å†µ

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| åŸºç¡€è®¾æ–½ | âœ… å®Œæˆ | store/product.js, store/notification.js, é€šç”¨ç»„ä»¶ |
| åŸæ–™å•† | âœ… å®Œæˆ | Products.vue, Harvest.vue |
| åŠ å·¥å•† | âœ… å®Œæˆ | Receive.vue, Process.vue |
| è´¨æ£€å‘˜ | âœ… å®Œæˆ | Pending.vue, Reports.vue + é€€å›/ç»ˆæ­¢åŠŸèƒ½ |
| é”€å”®å•† | âœ… å®Œæˆ | Inventory.vue, Sales.vue |
| æ¶ˆè´¹è€… | âœ… å®Œæˆ | Scan.vue, Report.vue, Detail.vue |

---

## ç¯å¢ƒè¦æ±‚

| ç»„ä»¶ | ç‰ˆæœ¬è¦æ±‚ |
|------|----------|
| Node.js | 16.x æˆ–ä»¥ä¸Š |
| Python | 3.8 æˆ–ä»¥ä¸Šï¼ˆåç«¯ï¼‰ |

---

## å¿«é€Ÿå¼€å§‹

### å‰ç«¯è¿è¡Œ

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

è®¿é—®ï¼šhttp://localhost:3000

### åç«¯è¿è¡Œ

> è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ ğŸ‘‰ [backend/README.md](backend/README.md)

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -i https://mirrors.aliyun.com/pypi/simple/ \
    fastapi uvicorn sqlalchemy python-jose passlib bcrypt==4.0.1 python-multipart

# å¯åŠ¨æœåŠ¡
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

è®¿é—®ï¼š
- API æ–‡æ¡£ï¼šhttp://localhost:8000/docs
- ReDocï¼šhttp://localhost:8000/redoc

### æµ‹è¯•è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
|--------|------|------|
| producer | 123456 | åŸæ–™å•† |
| processor | 123456 | åŠ å·¥å•† |
| inspector | 123456 | è´¨æ£€å‘˜ |
| seller | 123456 | é”€å”®å•† |
| consumer | 123456 | æ¶ˆè´¹è€… |

---

## å‰ç«¯é€šç”¨ç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| ChainConfirm | components/common/ChainConfirm.vue | ä¸Šé“¾ç¡®è®¤å¯¹è¯æ¡† |
| TraceCode | components/common/TraceCode.vue | æº¯æºç å±•ç¤º |
| AmendRecord | components/common/AmendRecord.vue | ä¿®æ­£è®°å½• |
| RejectDialog | components/common/RejectDialog.vue | é€€å›/ç»ˆæ­¢å¯¹è¯æ¡† |
| NotificationCenter | components/common/NotificationCenter.vue | é€šçŸ¥ä¸­å¿ƒ |

---

## å¼€å‘è¿›åº¦

- [x] å‰ç«¯æ¡†æ¶æ­å»ºï¼ˆVue 3 + Element Plus + Piniaï¼‰
- [x] åŸæ–™å•†æ¨¡å—ï¼ˆè‰ç¨¿/ä¸Šé“¾ã€é‡‡æ”¶å‡ºåº“ï¼‰
- [x] åŠ å·¥å•†æ¨¡å—ï¼ˆæ¥æ”¶ã€åŠ å·¥ã€é€æ£€ï¼‰
- [x] è´¨æ£€å‘˜æ¨¡å—ï¼ˆæ£€æµ‹ã€é€€å›/ç»ˆæ­¢ï¼‰
- [x] é”€å”®å•†æ¨¡å—ï¼ˆå…¥åº“ã€é”€å”®ã€äºŒç»´ç ï¼‰
- [x] æ¶ˆè´¹è€…æ¨¡å—ï¼ˆæ‰«ç ã€AIç®€æŠ¥ã€æº¯æºè¯¦æƒ…ï¼‰
- [x] é€šçŸ¥ç³»ç»Ÿ
- [x] Python åç«¯æ¡†æ¶ï¼ˆFastAPI + SQLAlchemy + JWTï¼‰
- [x] ç”¨æˆ·è®¤è¯ APIï¼ˆç™»å½•ã€æ³¨å†Œï¼‰
- [x] åŸæ–™å•†åç«¯ APIï¼ˆäº§å“ CRUDã€ä¸Šé“¾æ¥å£ï¼‰
- [x] FISCO BCOS åŒºå—é“¾éƒ¨ç½²ï¼ˆ4èŠ‚ç‚¹æœ¬åœ°é“¾ï¼‰
- [x] æº¯æºæ™ºèƒ½åˆçº¦å¼€å‘ï¼ˆSolidityï¼‰
- [x] åŸæ–™å•†ä¿®æ­£è®°å½• API
- [x] **åŸæ–™å•†å‰åç«¯è”è°ƒå®Œæˆ**ï¼ˆäº§å“ç®¡ç†ã€ä¸Šé“¾ã€ä¿®æ­£è®°å½•ã€æµè½¬è®°å½•æŸ¥è¯¢ï¼‰
- [ ] Python SDK è¿æ¥åŒºå—é“¾
- [ ] å…¶ä»–è§’è‰²åç«¯ APIï¼ˆåŠ å·¥å•†ã€è´¨æ£€å‘˜ã€é”€å”®å•†ã€æ¶ˆè´¹è€…ï¼‰
- [ ] AI æ¨¡å—ï¼ˆOCRè¯†åˆ«ã€ç®€æŠ¥ç”Ÿæˆï¼‰
- [ ] è”è°ƒæµ‹è¯•

è¯¦ç»†è¿›åº¦è¯·æŸ¥çœ‹ [å¼€å‘è®¡åˆ’.md](å¼€å‘è®¡åˆ’.md)

---

## åç«¯æœåŠ¡ (FastAPI)

åç«¯åŸºäº FastAPI + SQLAlchemy + JWT æ„å»ºï¼Œæä¾›å®Œæ•´çš„ RESTful APIã€‚

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | è¯´æ˜ |
|------|------|
| FastAPI | é«˜æ€§èƒ½å¼‚æ­¥ Web æ¡†æ¶ |
| SQLAlchemy | ORM æ•°æ®åº“æ“ä½œ |
| SQLite/MySQL | æ•°æ®å­˜å‚¨ï¼ˆå¼€å‘ç”¨ SQLiteï¼Œç”Ÿäº§ç”¨ MySQLï¼‰|
| python-jose | JWT Token è®¤è¯ |
| passlib + bcrypt | å¯†ç åŠ å¯† |

### å·²å®Œæˆ API

| æ¨¡å— | æ¥å£ | è¯´æ˜ |
|------|------|------|
| è®¤è¯ | POST `/api/auth/login` | ç”¨æˆ·ç™»å½• |
| è®¤è¯ | POST `/api/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| è®¤è¯ | GET `/api/auth/me` | è·å–å½“å‰ç”¨æˆ· |
| åŸæ–™å•† | GET `/api/producer/products` | è·å–äº§å“åˆ—è¡¨ |
| åŸæ–™å•† | POST `/api/producer/products` | åˆ›å»ºäº§å“ï¼ˆè‰ç¨¿ï¼‰|
| åŸæ–™å•† | PUT `/api/producer/products/{id}` | æ›´æ–°äº§å“ï¼ˆä»…è‰ç¨¿ï¼‰|
| åŸæ–™å•† | DELETE `/api/producer/products/{id}` | åˆ é™¤äº§å“ï¼ˆä»…è‰ç¨¿ï¼‰|
| åŸæ–™å•† | POST `/api/producer/products/{id}/submit` | æäº¤ä¸Šé“¾ |
| åŸæ–™å•† | POST `/api/producer/products/{id}/amend` | ä¿®æ­£è®°å½•ï¼ˆä»…å·²ä¸Šé“¾ï¼‰|
| åŸæ–™å•† | GET `/api/producer/products/{id}/records` | è·å–æµè½¬è®°å½• |
| åŸæ–™å•† | GET `/api/producer/statistics` | è·å–ç»Ÿè®¡æ•°æ® |

> å®Œæ•´åç«¯æ–‡æ¡£è¯·æŸ¥çœ‹ ğŸ‘‰ **[backend/README.md](backend/README.md)**

---

## åŒºå—é“¾ (FISCO BCOS)

å·²éƒ¨ç½² FISCO BCOS 3.0 æœ¬åœ°4èŠ‚ç‚¹è”ç›Ÿé“¾ã€‚

### æ™ºèƒ½åˆçº¦

æº¯æºæ™ºèƒ½åˆçº¦ï¼š`blockchain/contracts/AgriTrace.sol`

| åŠŸèƒ½ | æ–¹æ³• | æè¿° |
|------|------|------|
| åˆ›å»ºäº§å“ | `createProduct()` | åŸæ–™å•†ä¸Šé“¾ |
| æ·»åŠ è®°å½• | `addRecord()` | æ·»åŠ æµè½¬è®°å½• |
| ä¿®æ­£è®°å½• | `addAmendRecord()` | æäº¤ä¿®æ­£è®°å½• |
| äº§å“è½¬ç§» | `transferProduct()` | è½¬ç§»åˆ°ä¸‹ä¸€é˜¶æ®µ |
| è´¨æ£€æ“ä½œ | `inspectPass()` / `rejectProduct()` | è´¨æ£€é€šè¿‡/é€€å› |
| ç»ˆæ­¢äº§å“ | `terminateProduct()` | ç»ˆæ­¢äº§å“é“¾ |
| æŸ¥è¯¢ | `getProduct()` / `getRecord()` | è·å–äº§å“/è®°å½• |

### èŠ‚ç‚¹ä¿¡æ¯

| èŠ‚ç‚¹ | P2P ç«¯å£ | RPC ç«¯å£ |
|------|----------|----------|
| node0 | 30300 | 20200 |
| node1 | 30301 | 20201 |
| node2 | 30302 | 20202 |
| node3 | 30303 | 20203 |

### èŠ‚ç‚¹ç®¡ç†

```bash
# å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹
bash ~/nodes/127.0.0.1/start_all.sh

# åœæ­¢æ‰€æœ‰èŠ‚ç‚¹
bash ~/nodes/127.0.0.1/stop_all.sh

# æ£€æŸ¥èŠ‚ç‚¹è¿›ç¨‹
ps aux | grep fisco-bcos
```

> è¯¦ç»†åŒºå—é“¾é…ç½®è¯·æŸ¥çœ‹ ğŸ‘‰ **[backend/README.md#fisco-bcos-åŒºå—é“¾é…ç½®](backend/README.md#fisco-bcos-åŒºå—é“¾é…ç½®)**

---

## å¸¸è§é—®é¢˜

### 1. å‰ç«¯å¯åŠ¨å¤±è´¥

```bash
# æ¸…é™¤ç¼“å­˜é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install
npm run dev
```

### 2. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3000

# æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

### 3. Mock æ¨¡å¼è¯´æ˜

å‰ç«¯é»˜è®¤å¼€å¯ Mock æ¨¡å¼ï¼Œä½¿ç”¨ `store/product.js` ä¸­çš„æ¨¡æ‹Ÿæ•°æ®ï¼Œæ— éœ€åç«¯å³å¯æµ‹è¯•å®Œæ•´æµç¨‹ã€‚

### 4. åç«¯ bcrypt ç‰ˆæœ¬é”™è¯¯

```
AttributeError: module 'bcrypt' has no attribute '__about__'
```

**è§£å†³æ–¹æ¡ˆ**ï¼šå®‰è£…å…¼å®¹ç‰ˆæœ¬ `pip install bcrypt==4.0.1`

### 5. åç«¯å¸¸è§é—®é¢˜

æ›´å¤šåç«¯é—®é¢˜è¯·æŸ¥çœ‹ ğŸ‘‰ **[backend/README.md#å¸¸è§é—®é¢˜](backend/README.md#å¸¸è§é—®é¢˜)**

---

## License

MIT License
