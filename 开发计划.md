# 基于 FISCO BCOS 的可视化农产品生产溯源平台 - 开发计划

## 项目信息

- **项目名称**: 基于 FISCO BCOS（飞梭链）的可视化农产品生产溯源平台
- **学生**: 邓燕妮 (2022131039)
- **指导教师**: 待填写

---

## 技术选型

| 层次 | 技术 | 版本 |
|------|------|------|
| 区块链 | FISCO BCOS | 2.x |
| 智能合约 | Solidity | ^0.6.0 |
| 后端框架 | Spring Boot | 2.7.x |
| 区块链SDK | FISCO BCOS Java SDK | 2.9.x |
| 数据库 | MySQL | 8.0 |
| 前端框架 | Vue.js | 3.x |
| UI组件库 | Element Plus | 最新版 |
| 图表库 | ECharts | 5.x |
| AI服务 | Python + FastAPI | 3.9+ |
| OCR | PaddleOCR | 最新版 |

---

## 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        前端 (Vue.js 3)                          │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐       │
│  │原料商端│ │加工商端│ │质检端  │ │销售端  │ │消费者端│       │
│  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘       │
└─────────────────────────────────────────────────────────────────┘
                              │ HTTP
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    后端 (Spring Boot)                           │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │
│  │ 用户管理    │ │ 溯源业务    │ │ 二维码服务  │               │
│  └─────────────┘ └─────────────┘ └─────────────┘               │
└─────────────────────────────────────────────────────────────────┘
          │                                      │
          ▼                                      ▼
┌─────────────────────┐              ┌────────────────────────────┐
│  FISCO BCOS 区块链  │              │    Python AI 服务          │
│  ┌───────────────┐  │              │  ┌────────────────────┐    │
│  │ 智能合约      │  │              │  │ OCR 文字识别       │    │
│  │ - 产品注册    │  │              │  │ 图像分类识别       │    │
│  │ - 溯源记录    │  │              │  │ 可视化报告生成     │    │
│  │ - 数据查询    │  │              │  └────────────────────┘    │
│  └───────────────┘  │              └────────────────────────────┘
└─────────────────────┘
          │
          ▼
┌─────────────────────┐
│      MySQL          │
│  (链下数据存储)      │
└─────────────────────┘
```

---

## 功能模块

### 1. 用户管理模块

| 角色 | 说明 | 权限 |
|------|------|------|
| 原料商 (producer) | 原料生产者/农户 | 产品注册、种植/养殖信息录入、原料信息上链 |
| 加工商 (processor) | 加工厂/企业 | 加工信息录入、包装信息、加工记录上链 |
| 质检员 (inspector) | 质检机构人员 | 质检报告上传、检验结果录入、AI辅助识别 |
| 销售商 (seller) | 销售渠道/商超 | 产品上架、二维码生成、销售记录、物流信息 |
| 消费者 (consumer) | 终端用户 | 扫码查询、溯源信息查看、评价反馈 |

**功能清单**:
- [ ] 用户注册/登录（JWT认证）
- [ ] 多角色权限控制（RBAC）
- [ ] 用户信息管理
- [ ] 企业资质认证

### 2. 溯源信息管理模块

**数据流转**:
```
原料生产 → 加工处理 → 质量检验 → 销售流通 → 消费者查询
```

**各环节数据**:

| 环节 | 负责角色 | 记录内容 |
|------|----------|----------|
| 原料生产 | 原料商 | 品种、产地、种植/养殖时间、施肥用药记录、采摘/屠宰时间、负责人 |
| 加工处理 | 加工商 | 加工厂信息、加工工艺、包装规格、生产日期、保质期、批次号 |
| 质量检验 | 质检员 | 检验机构、检验项目、检验结果、质量等级、检验员、检验报告 |
| 销售流通 | 销售商 | 销售商信息、销售渠道、物流信息、仓储条件、销售时间 |

**功能清单**:
- [ ] 产品批次创建
- [ ] 各环节信息录入表单
- [ ] 信息上链存证
- [ ] 溯源信息查询
- [ ] 历史记录管理

### 3. 二维码管理模块

- [ ] 根据产品批次生成唯一二维码
- [ ] 二维码图片下载/打印
- [ ] 扫码解析跳转溯源页面
- [ ] 扫码次数统计

### 4. AI 数据处理模块

- [ ] **OCR识别**: 质检报告图片文字提取
- [ ] **图像分类**: 农产品图片识别
- [ ] **质量评估**: 基于图像的外观质量评分
- [ ] **报告生成**: 自动生成可视化溯源报告

### 5. 可视化展示模块

- [ ] **时间轴**: 展示产品从生产到销售的完整流程
- [ ] **产地地图**: 标注生产基地位置
- [ ] **数据图表**: 质检数据、生产数据可视化
- [ ] **证书展示**: 质检证书、资质证书展示

---

## 智能合约设计

### 数据结构

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

contract ProductTrace {

    // 产品信息
    struct Product {
        string productId;      // 产品批次号
        string productName;    // 产品名称
        string category;       // 产品类别
        string origin;         // 产地
        uint256 createTime;    // 创建时间
        address producer;      // 生产者地址
        bool exists;           // 是否存在
    }

    // 溯源记录
    struct TraceRecord {
        string recordId;       // 记录ID
        string productId;      // 关联产品
        string stage;          // 环节: PRODUCTION/PROCESSING/INSPECTION/SALES
        string dataHash;       // 数据哈希（详细数据存链下）
        string data;           // 关键数据JSON
        uint256 timestamp;     // 时间戳
        address operator;      // 操作者地址
    }

    // 存储映射
    mapping(string => Product) public products;
    mapping(string => TraceRecord[]) public traceRecords;

    // 事件
    event ProductCreated(string productId, string productName, address producer);
    event TraceRecordAdded(string productId, string stage, address operator);
}
```

### 合约方法

```solidity
// 创建产品
function createProduct(
    string memory _productId,
    string memory _productName,
    string memory _category,
    string memory _origin
) public returns (bool);

// 添加溯源记录
function addTraceRecord(
    string memory _productId,
    string memory _stage,
    string memory _data,
    string memory _dataHash
) public returns (bool);

// 查询产品信息
function getProduct(string memory _productId)
    public view returns (Product memory);

// 查询溯源记录
function getTraceRecords(string memory _productId)
    public view returns (TraceRecord[] memory);
```

---

## 数据库设计

### 用户表 (sys_user)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| username | VARCHAR(50) | 用户名 |
| password | VARCHAR(100) | 密码(加密) |
| real_name | VARCHAR(50) | 真实姓名 |
| phone | VARCHAR(20) | 手机号 |
| email | VARCHAR(100) | 邮箱 |
| role | VARCHAR(20) | 角色 |
| company_name | VARCHAR(100) | 企业名称 |
| blockchain_address | VARCHAR(100) | 区块链地址 |
| status | TINYINT | 状态 |
| create_time | DATETIME | 创建时间 |

### 产品表 (trace_product)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| product_id | VARCHAR(50) | 产品批次号 |
| product_name | VARCHAR(100) | 产品名称 |
| category | VARCHAR(50) | 类别 |
| origin | VARCHAR(200) | 产地 |
| producer_id | BIGINT | 生产者ID |
| qrcode_url | VARCHAR(200) | 二维码URL |
| status | TINYINT | 状态 |
| create_time | DATETIME | 创建时间 |

### 溯源记录表 (trace_record)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| record_id | VARCHAR(50) | 记录ID |
| product_id | VARCHAR(50) | 产品批次号 |
| stage | VARCHAR(20) | 环节 |
| data | TEXT | 详细数据JSON |
| images | TEXT | 图片URL列表 |
| tx_hash | VARCHAR(100) | 区块链交易哈希 |
| operator_id | BIGINT | 操作者ID |
| create_time | DATETIME | 创建时间 |

---

## 项目目录结构

```
komi-project/
├── 开发计划.md                 # 本文档
├── 毕设文件/                   # 毕设文档
│
├── blockchain/                 # 区块链相关
│   ├── nodes/                 # FISCO BCOS 节点
│   └── contracts/             # Solidity 智能合约
│       └── ProductTrace.sol
│
├── backend/                    # Spring Boot 后端
│   ├── pom.xml
│   └── src/main/java/com/trace/
│       ├── TraceApplication.java
│       ├── controller/        # API控制器
│       ├── service/           # 业务逻辑
│       ├── mapper/            # MyBatis映射
│       ├── entity/            # 实体类
│       ├── dto/               # 数据传输对象
│       ├── config/            # 配置类
│       ├── blockchain/        # 区块链交互
│       └── utils/             # 工具类
│
├── frontend/                   # Vue.js 前端
│   ├── package.json
│   ├── vite.config.js
│   └── src/
│       ├── main.js
│       ├── App.vue
│       ├── views/             # 页面组件
│       │   ├── login/         # 登录注册
│       │   ├── producer/      # 原料商页面
│       │   ├── processor/     # 加工商页面
│       │   ├── inspector/     # 质检员页面
│       │   ├── seller/        # 销售商页面
│       │   └── consumer/      # 消费者页面
│       ├── components/        # 通用组件
│       ├── router/            # 路由配置
│       ├── store/             # 状态管理
│       ├── api/               # API接口
│       └── utils/             # 工具函数
│
├── ai-service/                 # Python AI 服务
│   ├── requirements.txt
│   ├── main.py
│   └── app/
│       ├── routes/            # API路由
│       ├── services/          # 业务逻辑
│       └── models/            # AI模型
│
└── docs/                       # 其他文档
    ├── API文档.md
    └── 部署说明.md
```

---

## 开发计划

### 第一阶段：前端开发

**目标**: 完成所有页面UI和交互逻辑

| 任务 | 状态 | 说明 |
|------|------|------|
| 1.1 项目初始化 | ✅ | Vue3 + Vite + Element Plus |
| 1.2 登录注册页面 | ✅ | 表单验证、JWT存储 |
| 1.3 布局与导航 | ✅ | 侧边栏、顶部栏、权限菜单 |
| 1.4 原料商功能页面 | ✅ | 原料登记、生产记录 |
| 1.5 加工商功能页面 | ✅ | 加工记录、包装管理 |
| 1.6 质检员功能页面 | ✅ | 质检任务、质检报告 |
| 1.7 销售商功能页面 | ✅ | 商品管理、二维码、物流 |
| 1.8 消费者溯源页面 | ✅ | 扫码查询、时间轴可视化展示 |

### 第二阶段：后端开发

**目标**: 完成所有API接口

| 任务 | 状态 | 说明 |
|------|------|------|
| 2.1 项目初始化 | ✅ | Spring Boot 2.7.18 + MyBatis Plus 3.5.5 |
| 2.2 数据库设计 | ✅ | MySQL建表脚本已完成 |
| 2.3 用户管理API | ✅ | 注册、登录、JWT认证、权限控制 |
| 2.4 产品管理API | ✅ | CRUD操作 |
| 2.5 溯源记录API | ✅ | 各环节数据管理、质检报告 |
| 2.6 二维码API | ✅ | 生成、解析（ZXing库） |
| 2.7 文件上传API | ⬜ | 图片存储（待实现） |

### 第三阶段：区块链集成

**目标**: 实现数据上链与查询

| 任务 | 状态 | 说明 |
|------|------|------|
| 3.1 FISCO BCOS环境 | ⬜ | 搭建4节点联盟链 |
| 3.2 智能合约开发 | ⬜ | Solidity编写 |
| 3.3 合约部署 | ⬜ | 部署到链上 |
| 3.4 Java SDK集成 | ⬜ | 后端调用合约 |
| 3.5 上链功能实现 | ⬜ | 数据存证 |
| 3.6 查询功能实现 | ⬜ | 链上数据读取 |

### 第四阶段：AI模块开发

**目标**: 实现智能数据处理

| 任务 | 状态 | 说明 |
|------|------|------|
| 4.1 FastAPI项目 | ⬜ | 搭建Python服务 |
| 4.2 OCR功能 | ⬜ | PaddleOCR集成 |
| 4.3 图像分类 | ⬜ | 预训练模型 |
| 4.4 后端对接 | ⬜ | API调用 |

### 第五阶段：联调测试

| 任务 | 状态 | 说明 |
|------|------|------|
| 5.1 前后端联调 | ⬜ | 接口对接 |
| 5.2 区块链联调 | ⬜ | 上链查询测试 |
| 5.3 功能测试 | ⬜ | 完整流程 |
| 5.4 Bug修复 | ⬜ | 问题处理 |
| 5.5 演示准备 | ⬜ | 答辩材料 |

---

## API 接口设计

### 用户相关

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/auth/register | 用户注册 |
| POST | /api/auth/login | 用户登录 |
| GET | /api/user/info | 获取用户信息 |
| PUT | /api/user/info | 更新用户信息 |

### 产品相关

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/product | 创建产品 |
| GET | /api/product/{id} | 获取产品详情 |
| GET | /api/product/list | 产品列表 |
| PUT | /api/product/{id} | 更新产品 |

### 溯源相关

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/trace/record | 添加溯源记录 |
| GET | /api/trace/{productId} | 查询溯源信息 |
| GET | /api/trace/qrcode/{productId} | 获取二维码 |

### AI相关

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/ai/ocr | OCR识别 |
| POST | /api/ai/classify | 图像分类 |

---

## 参考资料

- FISCO BCOS 官方文档: https://fisco-bcos-documentation.readthedocs.io/
- FISCO BCOS Java SDK: https://github.com/FISCO-BCOS/java-sdk
- Vue 3 官方文档: https://cn.vuejs.org/
- Element Plus: https://element-plus.org/
- ECharts: https://echarts.apache.org/
- PaddleOCR: https://github.com/PaddlePaddle/PaddleOCR

---

*最后更新: 2025-12-23*
