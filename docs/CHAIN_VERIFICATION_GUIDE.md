# 🔍 区块链数据验证指南

本指南介绍如何验证农产品数据是否真实上链。

## 快速验证 (推荐)

### 方法1: 使用验证脚本

```bash
cd /home/pdm/DEV/komi-project/backend
source venv/bin/activate

# 验证单个溯源码
python3 /home/pdm/DEV/komi-project/scripts/verify_chain.py TRACE-20251226-E5DE1560

# 列出所有链上产品
python3 /home/pdm/DEV/komi-project/scripts/verify_chain.py --list
```

### 方法2: 使用 Console

```bash
cd /home/pdm/fisco/console
bash console.sh

# 在Console中执行:
call AgriTrace 0x6849f21d1e455e9f0712b1e99fa4fcd23758e8f1 verifyTraceCode "TRACE-20251226-E5DE1560"
call AgriTrace 0x6849f21d1e455e9f0712b1e99fa4fcd23758e8f1 getProductCount
```

### 方法3: 通过 API

```bash
# 验证溯源码
curl "http://localhost:8000/api/blockchain/verify/TRACE-20251226-E5DE1560"

# 获取链上数据详情
curl "http://localhost:8000/api/blockchain/product/TRACE-20251226-E5DE1560/chain-data"
```

## 验证示例输出

```bash
$ python3 /home/pdm/DEV/komi-project/scripts/verify_chain.py TRACE-20251226-E5DE1560

======================================================================
🔍 区块链数据验证工具
======================================================================

📋 待验证溯源码: TRACE-20251226-E5DE1560

----------------------------------------------------------------------
1️⃣  验证溯源码是否存在
----------------------------------------------------------------------
✅ 验证通过: 溯源码存在于区块链上

----------------------------------------------------------------------
2️⃣  查询链上产品总数
----------------------------------------------------------------------
链上产品总数: 8 个

----------------------------------------------------------------------
3️⃣  当前区块高度
----------------------------------------------------------------------
当前区块: 14

----------------------------------------------------------------------
4️⃣  区块链连接状态
----------------------------------------------------------------------
连接状态: ✅ 已连接
RPC 地址: http://127.0.0.1:20200
合约地址: 0x6849f21d1e455e9f0712b1e99fa4fcd23758e8f1
```

## 列出所有产品

```bash
$ python3 /home/pdm/DEV/komi-project/scripts/verify_chain.py --list

共 6 个已上链产品:

1. TRACE-20251226-E5DE1560
   名称: 有机西红柿
   产地: 山东省寿光市
   数量: 1000.0 kg
   区块: #4
   交易哈希: 0x2e2ca21bbc6056e85ab9f0ffc816f21d0dde0bbdea59a8693c69d23373ee672a

2. TRACE-20251226-0E87D447
   名称: 苹果
   产地: 苹果村
   数量: 2.0 kg
   区块: #7
   交易哈希: 0xf64d7508322fce10adfe248510f73bd1d45101ce8af625e5442589799d4fee07
   
...
```

## 前端查看链上数据

1. 打开 http://localhost:5173
2. 登录原料商 (producer / 123456)
3. 进入"原料管理"
4. 找到已上链产品
5. 点击"链上数据验证"
6. 查看链上数据详情

## 交易哈希说明

每个上链操作都会生成唯一的交易哈希,作为数据上链的凭证:

- **作用**: 证明数据确实在区块链上
- **特性**: 唯一、不可篡改、可追溯
- **验证**: 可以通过Console或区块浏览器验证

## 数据真实性保证

✅ **数据确实在区块链上**:
1. Console验证返回true
2. 有交易哈希和区块号
3. 数据库与链同步(上链时同时写入)

✅ **数据不可篡改**:
1. 区块链特性: 一旦上链,无法修改
2. 只能追加修正记录
3. 原始数据永久保存

## 常见问题

**Q: Console中文乱码怎么办?**
A: 这是编码问题,数据本身正确。使用验证脚本或API查看。

**Q: 如何100%确认数据上链?**
A: 三重验证: Console验证 + 交易哈希 + 区块号

**Q: 前端数据和链上数据一致吗?**
A: 是的,上链时同时写入数据库和链,数据完全同步。
